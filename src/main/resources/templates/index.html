<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout/layout"
      lang="en">
<head>
  <title>Automata</title>
</head>
<body>
<div class="container">

  <div id="newbuild">
    <h1>New Build</h1>

      <div class="mb-3">
        <label for="inputBranch" class="form-label">Branch name</label>
        <input type="text" class="form-control" id="inputBranch" value="globale_experiment">
      </div>

      <div class="mb-3">
        <label for="inputEnvironmentCode" class="form-label">Environment</label>
        <input type="text" class="form-control" id="inputEnvironmentCode" value="d1">
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="sendAlerts" checked>
        <label class="form-check-label" for="sendAlerts">Send me alerts about the build</label>
      </div>

      <button id="btnSubmitNewBuild" type="submit" class="btn btn-primary">Submit</button>
  </div>

  <div id="environments">
    <h1>Environments</h1>

    <div class="row">
        <div class="card col-lg" style="width: 18rem;" th:each="environments: ${environments.value}">
          <div th:class="card-body">
            <h5 class="card-title" th:text="${environments.code}"></h5>
            <p class="card-text" th:text="'Type ' + ${environments.type}"></p>
            <p class="card-text" th:text="'Status ' + ${environments.status}"></p>
        </div>
      </div>
    </div>
  </div>

  <div id="deployments">
    <h1>Deployments</h1>

    <table class="table table-striped table-hover table-bordered">
      <thead class="thead-dark">
      <tr>
        <th class="col">Code</th>
        <th class="col">Status</th>
        <th class="col">Created by</th>
        <th class="col">Build code</th>
        <th class="col">Environment</th>
        <th class="col">Started at</th>
        <th class="col">Finished at</th>
        <th class="col">Failed at</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="build: ${deployments.value}" th:class="${build.status} =='FAIL' ? 'table-danger' : ''">
        <td th:text="${build.code}">
        <td th:text="${build.status}">
        <td th:text="${build.createdBy}">
        <td th:text="${build.buildCode}">
        <td th:text="${build.environmentCode}">
        <td th:text="${build.scheduledTimestamp}">
        <td th:text="${build.deployedTimestamp}">
        <td th:text="${build.failedTimestamp}">
      </tr>
      </tbody>
    </table>
  </div>


  <div class="builds">
    <h1>Builds</h1>
    <table class="table table-striped table-hover table-bordered">
      <thead class="thead-dark">
      <tr>
        <th class="col">Code</th>
        <th class="col">Name</th>
        <th class="col">Branch</th>
        <th class="col">Status</th>
        <th class="col">Started at</th>
        <th class="col">Finished at</th>
        <th class="col">Created by</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="build: ${builds.value}" th:class="${build.status} =='FAIL' ? 'table-danger' : ''">
        <td th:text="${build.code}">
        <td th:text="${build.name}">
        <td th:text="${build.branch}">
        <td th:text="${build.status}">
        <td th:text="${#temporals.format(build.buildStartTimestamp, 'dd-MM-yyyy HH:mm')}">
        <td th:text="${#temporals.format(build.buildEndTimestamp, 'dd-MM-yyyy HH:mm')}">
        <td th:text="${build.createdBy}">
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>

<link rel="stylesheet" href="css/main.css"/>
<link rel="stylesheet" href="bootstrap-5.0.2-dist/css/bootstrap.css"/>
<script defer src="http://localhost:35729/livereload.js"></script>

</html>
<script>
  async function makeBuild() {
    const newBuildRequest = {
      branchName: 'globale_experiment',
      environmentCode: 'd1'
    }

    console.log(newBuildRequest);

    const response = await fetch("/newbuild", {
      method: 'POST',
      headers: {
        "Content-Type": 'application/json',
      },
      body: JSON.stringify(newBuildRequest),
    });

    const result = await response.json();
    console.log(result)
  }

  let btnSubmit = document.getElementById('btnSubmitNewBuild');
  btnSubmit.onclick = makeBuild;

  var objeto = {
    teste: "aaaa",
    segundo: 1111,
    aa: "bbb"
  };

  // const replacerFunction = function(key, value) {
  //     console.log(key, value);
  //
  //     return value;
  // }

  const replacerFunction = ['aa'];

  console.log(JSON.stringify(objeto, replacerFunction));
</script>